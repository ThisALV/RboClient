#:kivy 2.0.0

<SessionCtxActions>:
    DisconnectAction:
        id: disconnect

<BookMsg>:
    size_hint: (1, None)
    italic: True
    markup: True
    font_size: 15
    text_size: (self.width, None)
    size: self.texture_size
    halign: "center"

<BookSection>:
    size_hint: (1, None)
    height: 50
    bold: True
    font_size: 20

<Book>:
    background: bright
    spacing: 2

<Dices>:
    rollFinished: self.rollingDelayMs >= self.lastRollingDelayMs
    font_name: "DejaVuSans"
    font_size: "120"
    bold: True
    halign: "center"
    text_size: (self.width, None)
    size: self.texture_size

<DiceRoll>:
    orientation: "vertical"
    rollAnimation: rollAnimation
    canvas.before:
        Color:
            rgb: dark
        Rectangle:
            pos: self.pos
            size: self.size
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        padding: 15
        BoxLayout:
            orientation: "vertical"
            Label:
                font_size: 30
                text: root.message
                text_size: (self.width, None)
                size: self.texture_size
                halign: "center"
            Label:
                font_size: 20
                italic: True
                text: "" if root.bonus == 0 else "{} : {}".format("Bonus" if root.bonus > 0 else "Malus", root.bonus)
            Label:
                font_size: 25
                text: "Résultat : " + str(sum(root.result) + root.bonus)
                color: [1, 1, 1, 1 if rollAnimation.rollFinished else 0]
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        padding: (5, 20)
        Dices:
            id: rollAnimation
            dices: root.dices
    BoxLayout:
        orientation: "horizontal"
        size_hint: (1, .2)
        padding: 5
        RboBtn:
            size_hint: (.75, 1)
            text: "Terminé" if rollAnimation.rolled else "Lancer les dés"
            on_release: root.next()
        RboBtn:
            size_hint: (.25, 1)
            text: ">>"
            background_color: [.5, .5, .5]
            on_release: root.next(skip=True)

<StatValue>:
    size_hint: (.5, None)
    height: 15
    halign: "left"
    text_size: self.size
    markup: True
    text: "[b]{} :[/b] {}".format(self.name, self.value)

<Player>:
    orientation: "vertical"
    size_hint: (1, None)
    height: 150
    padding: 15
    stats: stats
    canvas.before:
        Color:
            rgb: white if self.selected else dark
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: "horizontal"
        size_hint: (1, None)
        height: 30
        AnchorLayout:
            anchor_x: "left"
            Label:
                size_hint: (None, 1)
                width: self.height
                color: dark
                text: str(root.playerID)
                font_size: 20 if root.selected else 15
                bold: True
                canvas.before:
                    Color:
                        rgb: [1, 1, 0] if root.isLeader and not root.selected else white
                    Rectangle:
                        pos: self.pos
                        size: self.size
        Label:
            bold: root.isSelf
            text: root.name
            font_size: 20
            color: dark if root.selected else white
        AnchorLayout:
            anchor_x: "right"
            Label:
                size_hint: (None, 1)
                width: self.height
                bold: True
                font_name: "DejaVuSans"
                font_size: self.height
                text: root.requestStatus[root.hasReplied][0]
                color: root.requestStatus[root.hasReplied][1]
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        padding: 10
        StatsView:
            id: stats
            background: white if root.selected else dark
            foreground: dark if root.selected else white

<DetailsLayout>:
    # En attendant que le widget soit affiché (et donc qu'il ait un parent), on lui donne une taille nulle
    size_hint: (1, None)
    height: 0 if self.parent is None else self.parent.height / 2
    padding: 15

<DetailsTitle@Label>:
    size_hint: (1, None)
    height: 50
    text_size: self.size
    halign: "left"
    font_size: 30
    bold: True

<Detail@Label>:
    size_hint: (1, None)
    height: 40
    text_size: self.size
    halign: "left"
    font_size: 20

<GameDetails>:
    mainStats: mainStats
    DetailsTitle:
        text: root.gameName
    Detail:
        text: "Page : " + str(root.scene)
    Detail:
        text: "Leader : " + str(root.leader)
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        StatsView:
            id: mainStats
            background: middle

<GlobalDetails>:
    stats: stats
    DetailsTitle:
        text: "Statistiques globales :"
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        StatsView:
            id: stats
            background: middle

<PlayerDetails>:
    stats: stats
    BoxLayout:
        orientation: "horizontal"
        size_hint: (1, None)
        height: 50
        DetailsTitle:
            text: "[{}] {}".format(root.id, root.name)
        AnchorLayout:
            anchor_x: "right"
            RboBtn:
                size_hint: (None, None)
                size: (30, 30)
                text: "\u00d7"
                font_size: 20
                on_release: root.dispatch("on_close")
    Detail:
        text: "Leader ? " + ("Oui" if root.leader else "Non")
        color: [0, 1, 0] if root.leader else [1, 0, 0]
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        StatsView:
            id: stats
            size_hint: (.75, .75)
            background: middle

<Details>:
    gameDetails: gameDetails
    canvas.before:
        Color:
            rgb: middle
        Rectangle:
            pos: self.pos
            size: self.size
    GameDetails:
        id: gameDetails

<Session>:
    orientation: "horizontal"
    gameplay: gameplay
    book: book
    confirm: confirm
    detailsScreen: detailsScreen
    players: players
    BoxLayout:
        orientation: "vertical"
        size_hint: (1.4, 1)
        Gameplay:
            id: gameplay
            size_hint: (1, 3.5)
            Book:
                id: book
                pos_hint: {"x": 0, "y": 0}
                size_hint: (1, 1)
        AnchorLayout:
            anchor_x: "center"
            anchor_y: "center"
            canvas.before:
                Color:
                    rgb: middle
                Rectangle:
                    pos: self.pos
                    size: self.size
            RboBtn:
                id: confirm
                size_hint: (.6, .4)
                text: "Confirmer"
                disabled: True
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        id: detailsScreen
    Players:
        id: players
        size_hint: (.7, 1)